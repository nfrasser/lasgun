const scene = lasgun.scene({
    eye: [0.0, 2.0, 30.0],
    view: [0.0, 0.0, -1.0],
    up: [0.0, 1.0, 0.0],
    ambient: [0.4, 0.4, 0.4],
    width: 512,
    height: 512,
    fov: 50.0,
    sampling: 0
})
let contents = lasgun.contents();

scene.add_point_light({
    position: [200.0, 202.0, 430.0],
    intensity: [0.8, 0.8, 0.8],
    falloff: [1.0, 0.0, 0.0]
})

let stone = scene.add_phong_material({ kd: [0.8, 0.7, 0.7], ks: [0.0, 0.0, 0.0], shininess: 0 })
let grass = scene.add_phong_material({ kd: [0.1, 0.7, 0.1], ks: [0.0, 0.0, 0.0], shininess: 0 })
let hide = scene.add_phong_material({ kd: [0.84, 0.6, 0.53], ks: [0.3, 0.3, 0.3], shininess: 20 })

// Ring of arches
for (let i = 0; i < 6; i++) {

    let p1 = lasgun.contents()
    p1.add_cube({ origin: [0.0, 0.0, 0.0], dim: 1.0 }, stone)
    p1.scale(0.8, 4.0, 0.8)
    p1.translate(-2.4, 0.0, -0.4)

    let p2 = lasgun.contents()
    p2.add_cube({ origin: [0.0, 0.0, 0.0], dim: 1.0 }, stone)
    p2.scale(0.8, 4.0, 0.8)
    p2.translate(1.6, 0.0, -0.4)

    let s = lasgun.contents()
    s.add_sphere({ origin: [0.0, 0.0, 0.0], radius: 1.0 }, stone)
    s.scale(4.0, 0.6, 0.6)
    s.translate(0.0, 4.0, 0.0)

    let arc = lasgun.contents()
    arc.add_node(p1)
    arc.add_node(p2)
    arc.add_node(s)

    arc.translate(0.0, 0.0, -10.0)
    arc.rotate_y(((i-1) * 60))

    contents.add_node(arc)
}

// Create some simple cows, transforming each one
for (let [translation, rotation] of [
    [[1.0, 1.3, 14.0], 20.0],
    [[5.0, 1.3, -11.0], 180.0],
    [[-5.5, 1.3, -3.0], -60.0],
]) {
    let cow = lasgun.contents()
    cow.scale(1.4, 1.4, 1.4)
    cow.rotate_y(rotation)
    cow.translate(...translation)

    for (let [origin, radius] of [
        [[0.0, 0.0, 0.0], 1.0],           // body
        [[0.9, 0.3, 0.0], 0.6],       // head
        [[-0.94, 0.34, 0.0], 0.2],    // tail
        [[0.7, -0.7, -0.7], 0.3],      // lfleg
        [[-0.7, -0.7, -0.7], 0.3],     // lrleg
        [[0.7, -0.7, 0.7], 0.3],       // rfleg
        [[-0.7, -0.7, 0.7], 0.3],      // rrleg
    ]) {
        cow.add_sphere({ origin, radius }, hide)
    }

    contents.add_node(cow)
}

// The Floor
let plane = lasgun.contents()
plane.scale(30.0, 30.0, 30.0)
let planeverts = new Float32Array([
    -1.0, 0.0, -1.0,
    1.0, 0.0, -1.0,
    1.0, 0.0, 1.0,
    -1.0, 0.0, 1.0,
])
let planefaces = new Uint32Array([
    0, 2, 1,
    0, 3, 2
])
plane.add_mesh({ vertices: planeverts, faces: planefaces }, grass)
contents.add_node(plane)

// Central altar
let buckyball = lasgun.contents()
buckyball.scale(1.5, 1.5, 1.5)
let buckyverts = new Float32Array([
    2.118034, -1.000000, 0.809017,
    2.427051, -0.500000, -0.000000,
    2.118034, -1.000000, -0.809017,
    1.618034, -1.809017, 0.500000,
    1.618034, -1.809017, -0.500000,
    0.000000, -2.427051, 0.500000,
    -0.809017, -2.118034, 1.000000,
    -0.500000, -1.618034, 1.809017,
    0.809017, -2.118034, 1.000000,
    0.500000, -1.618034, 1.809017,
    0.809017, -2.118034, -1.000000,
    0.500000, -1.618034, -1.809017,
    -0.500000, -1.618034, -1.809017,
    0.000000, -2.427051, -0.500000,
    -0.809017, -2.118034, -1.000000,
    2.118034, 1.000000, 0.809017,
    1.618034, 1.809017, 0.500000,
    1.618034, 1.809017, -0.500000,
    2.427051, 0.500000, 0.000000,
    2.118034, 1.000000, -0.809017,
    0.500000, 1.618034, 1.809017,
    -0.500000, 1.618034, 1.809017,
    -0.809017, 2.118034, 1.000000,
    0.809017, 2.118034, 1.000000,
    0.000000, 2.427051, 0.500000,
    -0.809017, 2.118034, -1.000000,
    -0.500000, 1.618034, -1.809017,
    0.500000, 1.618034, -1.809017,
    0.000000, 2.427051, -0.500000,
    0.809017, 2.118034, -1.000000,
    1.809017, -0.500000, -1.618034,
    1.809017, 0.500000, -1.618034,
    1.000000, 0.809017, -2.118034,
    1.000000, -0.809017, -2.118034,
    0.500000, 0.000000, -2.427051,
    -0.500000, 0.000000, -2.427051,
    -1.000000, 0.809017, -2.118034,
    -1.809017, 0.500000, -1.618034,
    -1.000000, -0.809017, -2.118034,
    -1.809017, -0.500000, -1.618034,
    -2.427051, -0.500000, -0.000000,
    -2.118034, -1.000000, 0.809017,
    -1.618034, -1.809017, 0.500000,
    -2.118034, -1.000000, -0.809017,
    -1.618034, -1.809017, -0.500000,
    -2.118034, 1.000000, -0.809017,
    -1.618034, 1.809017, -0.500000,
    -1.618034, 1.809017, 0.500000,
    -2.427051, 0.500000, -0.000000,
    -2.118034, 1.000000, 0.809017,
    -1.809017, -0.500000, 1.618034,
    -1.809017, 0.500000, 1.618034,
    -1.000000, 0.809017, 2.118034,
    -1.000000, -0.809017, 2.118034,
    -0.500000, 0.000000, 2.427051,
    1.000000, -0.809017, 2.118034,
    0.500000, 0.000000, 2.427051,
    1.000000, 0.809017, 2.118034,
    1.809017, -0.500000, 1.618034,
    1.809017, 0.500000, 1.618034,
])
let buckyfaces = new Uint32Array([
    60, 59, 1,
    60, 1, 2,
    60, 2, 19,
    60, 19, 16,
    16, 17, 24,
    16, 24, 21,
    16, 21, 58,
    16, 58, 60,
    21, 22, 53,
    21, 53, 55,
    21, 55, 57,
    21, 57, 58,
    55, 54, 8,
    55, 8, 10,
    55, 10, 56,
    55, 56, 57,
    10, 9, 4,
    10, 4, 1,
    10, 1, 59,
    10, 59, 56,
    22, 23, 48,
    22, 48, 50,
    22, 50, 52,
    22, 52, 53,
    50, 49, 41,
    50, 41, 42,
    50, 42, 51,
    50, 51, 52,
    42, 43, 7,
    42, 7, 8,
    42, 8, 54,
    42, 54, 51,
    23, 25, 29,
    23, 29, 26,
    23, 26, 47,
    23, 47, 48,
    26, 27, 37,
    26, 37, 38,
    26, 38, 46,
    26, 46, 47,
    38, 40, 44,
    38, 44, 41,
    38, 41, 49,
    38, 49, 46,
    43, 45, 15,
    43, 15, 14,
    43, 14, 6,
    43, 6, 7,
    45, 44, 40,
    45, 40, 39,
    45, 39, 13,
    45, 13, 15,
    27, 28, 33,
    27, 33, 35,
    27, 35, 36,
    27, 36, 37,
    35, 34, 12,
    35, 12, 13,
    35, 13, 39,
    35, 39, 36,
    28, 30, 18,
    28, 18, 20,
    28, 20, 32,
    28, 32, 33,
    20, 19, 2,
    20, 2, 3,
    20, 3, 31,
    20, 31, 32,
    3, 5, 11,
    3, 11, 12,
    3, 12, 34,
    3, 34, 31,
    30, 29, 25,
    30, 25, 24,
    30, 24, 17,
    30, 17, 18,
    5, 4, 9,
    5, 9, 6,
    5, 6, 14,
    5, 14, 11,
    4, 5, 3,
    4, 3, 2,
    4, 2, 1,
    9, 10, 8,
    9, 8, 7,
    9, 7, 6,
    14, 15, 13,
    14, 13, 12,
    14, 12, 11,
    19, 20, 18,
    19, 18, 17,
    19, 17, 16,
    24, 25, 23,
    24, 23, 22,
    24, 22, 21,
    29, 30, 28,
    29, 28, 27,
    29, 27, 26,
    34, 35, 33,
    34, 33, 32,
    34, 32, 31,
    39, 40, 38,
    39, 38, 37,
    39, 37, 36,
    44, 45, 43,
    44, 43, 42,
    44, 42, 41,
    49, 50, 48,
    49, 48, 47,
    49, 47, 46,
    54, 55, 53,
    54, 53, 52,
    54, 52, 51,
    59, 60, 58,
    59, 58, 57,
    59, 57, 56
].map(i => i - 1))
buckyball.add_mesh({ vertices: buckyverts, faces: buckyfaces }, stone)
contents.add_node(buckyball)

contents.rotate_x(23.0)
scene.set_contents(contents)
exports.scene = scene
